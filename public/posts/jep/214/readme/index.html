<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>My New Hugo Site </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.40-DEV" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.e08a958ae3e530145318b6373195c765.css" rel="stylesheet">
    

    

    
      
    

    

    <meta property="og:title" content="" />
<meta property="og:description" content="Table 1. Metadata     JEP
 214
   Title
 Jenkins Telemetry
   Sponsor
 Daniel Beck
   Status
 Draft :speech_balloon:
   Type
 Standards
   Created
 2018-08-30
   BDFL-Delegate
 R Tyler Croy
     Table of Contents Abstract Specification Motivation Reasoning Combination with Evergreen telemetry (JEP-308) Reuse of existing anonymous usage statistics   Backwards Compatibility Security Infrastructure Requirements Testing Prototype Implementation References    Abstract Jenkins is exclusively distributed to users for installation on their own infrastructure." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/jep/214/readme/" />
















<meta itemprop="name" content="">
<meta itemprop="description" content="Table 1. Metadata     JEP
 214
   Title
 Jenkins Telemetry
   Sponsor
 Daniel Beck
   Status
 Draft :speech_balloon:
   Type
 Standards
   Created
 2018-08-30
   BDFL-Delegate
 R Tyler Croy
     Table of Contents Abstract Specification Motivation Reasoning Combination with Evergreen telemetry (JEP-308) Reuse of existing anonymous usage statistics   Backwards Compatibility Security Infrastructure Requirements Testing Prototype Implementation References    Abstract Jenkins is exclusively distributed to users for installation on their own infrastructure.">



<meta itemprop="wordCount" content="890">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Table 1. Metadata     JEP
 214
   Title
 Jenkins Telemetry
   Sponsor
 Daniel Beck
   Status
 Draft :speech_balloon:
   Type
 Standards
   Created
 2018-08-30
   BDFL-Delegate
 R Tyler Croy
     Table of Contents Abstract Specification Motivation Reasoning Combination with Evergreen telemetry (JEP-308) Reuse of existing anonymous usage statistics   Backwards Compatibility Security Infrastructure Requirements Testing Prototype Implementation References    Abstract Jenkins is exclusively distributed to users for installation on their own infrastructure."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="http://example.org/" class="f3 fw2 hover-white no-underline white-90 dib">
      My New Hugo Site
    </a>
    <div class="flex-l items-center">
      
      









    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  <article class="flex-l flex-wrap justify-between mw8 center ph3 ph0-l">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1"></h1>
      
      <time class="f6 mv4 dib tracked" datetime="0001-01-01T00:00:00Z">January 1, 0001</time>
    </header>

    <main class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><div id="preamble">
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Metadata</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">JEP</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">214</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Title</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jenkins Telemetry</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Sponsor</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/daniel-beck">Daniel Beck</a></p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Status</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft :speech_balloon:</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Type</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standards</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Created</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-08-30</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">BDFL-Delegate</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/rtyler">R Tyler Croy</a></p></td>
</tr>
</tbody>
</table>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_abstract">Abstract</a></li>
<li><a href="#_specification">Specification</a></li>
<li><a href="#_motivation">Motivation</a></li>
<li><a href="#_reasoning">Reasoning</a>
<ul class="sectlevel2">
<li><a href="#_combination_with_evergreen_telemetry_jep_308">Combination with Evergreen telemetry (JEP-308)</a></li>
<li><a href="#_reuse_of_existing_anonymous_usage_statistics">Reuse of existing anonymous usage statistics</a></li>
</ul>
</li>
<li><a href="#_backwards_compatibility">Backwards Compatibility</a></li>
<li><a href="#_security">Security</a></li>
<li><a href="#_infrastructure_requirements">Infrastructure Requirements</a></li>
<li><a href="#_testing">Testing</a></li>
<li><a href="#_prototype_implementation">Prototype Implementation</a></li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="_abstract">Abstract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jenkins is exclusively distributed to users for installation on their own infrastructure.
This presents challenges when evolving Jenkins, as we typically only learn about problems after a change has been delivered.
This JEP proposes infrastructure for gathering usage telemetry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specification">Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>Telemetry</code> extension point is added to Jenkins (core). It allows implementations in core or plugins ("collectors") to define the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ID matching <code>[a-zA-Z0-9_-]+</code> (i.e. alphanumeric with dash and underscore)</p>
</li>
<li>
<p>User-friendly (localizable) display name</p>
</li>
<li>
<p>Time period (start and end date) during which data collection is enabled on the client (end date is mandatory)</p>
</li>
<li>
<p>A method returning the <code>JSONObject</code> to be submitted to the Jenkins project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The implementation in core has the following characteristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Collection and submission is possible only if the instance participates in anonymous usage statistics.</p>
</li>
<li>
<p>Each collector is run periodically to build its content, and the central extension point will submit it to the Jenkins project infrastructure via HTTPS.</p>
</li>
<li>
<p>A facility explaining what data is collected, to be shown to administrators.</p>
</li>
<li>
<p>The endpoint the data is submitted to is not modifiable by extension point implementations.</p>
</li>
<li>
<p>It submits a correlation ID to the Jenkins project to allow merging and deduplicating submissions from the same Jenkins instance.
This correlation ID is independent of instance identity or any other public identifier.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are occasionally in the situation that we need to understand how Jenkins is used or configured, typically to estimate the feasibility or impact of a planned change.
As Jenkins is not a hosted SaaS, but distributed for local installation, we have very limited ways to get any information from our users in advance of actually performing the changes.
Combined with the complexity of having 1500+ plugins with virtually unrestricted access to internal APIs means the risk of problems due to major changes is rather high.
While we have <em>some</em> tooling (mostly related to Java API use across components), that might only be a small subset of what we&#8217;d need to know.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reasoning">Reasoning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_combination_with_evergreen_telemetry_jep_308">Combination with Evergreen telemetry (JEP-308)</h3>
<div class="paragraph">
<p>Evergreen telemetry and this proposal have multiple key differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Evergreen focuses on monitoring Jenkins from the outside, observing output such as log messages, while the proposed telemetry would be internal to Jenkins.</p>
</li>
<li>
<p>Evergreen stores data for a large period of time, while the proposed telemetry is gathered for a specific purpose and intended to be collected for a defined, short period of time.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_reuse_of_existing_anonymous_usage_statistics">Reuse of existing anonymous usage statistics</h3>
<div class="paragraph">
<p>While there are anonymous usage statistics, the data provided is fairly limited (mostly basic master/agent setup, job types and count, and installed plugins).
Additionally, its collection protocol does not allow for it to be easily extended with additional information due to length restrictions.
Even worse, the server-side processing code, as of 2018, is complex and very difficult to change.</p>
</div>
<div class="paragraph">
<p>It is also not designed to support the time limited collection of telemetry that is an important part of this proposal.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_backwards_compatibility">Backwards Compatibility</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are no backwards compatibility concerns related to this proposal.</p>
</div>
<div class="paragraph">
<p>Feedback to the initial proposal indicated a desire to merge this with JEP-308.
As each collector is an independent extension implementation only operational within a defined time period, we are able to retire/version the extension point in core aggressively to support future improvements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security">Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Collectors need to be written carefully to not collect user data, such as PII.
The server component needs to ensure isolation between different collected information, grant access to the collected data in a fine-grained manner, and enforce the collector start and end dates server-side.</p>
</div>
<div class="paragraph">
<p>Data submission is done via HTTPS to prevent eavesdropping and man-in-the-middle attacks.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_infrastructure_requirements">Infrastructure Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A new service needs to be added to the Jenkins project infrastructure.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A URL that accepts POST submissions with a JSON body and stores them. The JSON dictionary has the following top-level items:</p>
<div class="ulist">
<ul>
<li>
<p><code>type</code> (string identifying the collector by ID)</p>
</li>
<li>
<p><code>payload</code> (a JSON object)</p>
</li>
<li>
<p><code>correlator</code> (an arbitrary per-instance identifier)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Support for definition of a collection period (start and end date), outside of which submissions are rejected.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Beyond these, the service can remain fairly basic, e.g. writing submission bodies to files, similar to the logging performed in the usage statistics service.</p>
</div>
<div class="paragraph">
<p>The traffic for each collector depends on several parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The size of data gathered for each collector</p>
</li>
<li>
<p>The number of instances for each collector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter depends on the time span defined for a collector, and the component implementing the collector (popularity and user update behavior).
For collectors defined in core, current usage statistics indicate that around 20,000-30,000 installations are on the current LTS line, and around 30,000 installations are on the most recent eight weekly releases.</p>
</div>
<div class="paragraph">
<p>This indicates a projected upper bound of 600MB of uncompressed data collected per day for a collector defined in core that is active for two months, if we expect a maximum average size of 10KB.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing">Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Automatic tests in Jenkins core need to ensure the constraints defined for this system (administrator control via usage statistics option, collection dates, etc.).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prototype_implementation">Prototype Implementation</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/jenkins/pull/3604">Core PR 3604</a></p>
</li>
<li>
<p><a href="https://github.com/rtyler/uplink/">"Uplink" service receiving data in Jenkins project infrastructure</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://groups.google.com/d/msg/jenkinsci-dev/CsESQQ1mxLY/8xQazCYbEAAJ">Initial proposal and request for feedback on jenkinsci-dev</a></p>
</li>
</ul>
</div>
</div>
</div>
<ul class="pa0">
  
</ul>
<div class="mt6">
        
      </div>
    </main>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://example.org/" >
    &copy; 2018 My New Hugo Site
  </a>
    <div>








</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
